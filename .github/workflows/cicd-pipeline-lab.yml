# Complete GitHub Actions workflow for data pipeline CI/CD

# This solution demonstrates enterprise-grade automation practices

# used by organizations like Netflix and DataCamp for reliable deployments

name: Data Pipeline CI/CD

on:

  push:

    branches: [ main ]

    paths:

      - 'src/**'

      - 'tests/**'

  pull_request:

    branches: [ main ]

    paths:

      - 'src/**'  

      - 'tests/**'

jobs:

  build-and-test:

    runs-on: ubuntu-latest

    

    steps:

    - name: Checkout code

      uses: actions/checkout@v3

      

    - name: Set up Python 3.9

      uses: actions/setup-python@v4

      with:

        python-version: '3.9'

        cache: 'pip'

        

    - name: Install dependencies

      run: |

        pip install -r requirements.txt

        pip install pytest pytest-cov

        

    - name: Run tests with coverage

      run: |

        pytest tests/ --cov=src/ --cov-report=xml

        

    - name: Build Docker image

      uses: docker/build-push-action@v4

      with:

        context: .

        push: true

        tags: |

          myregistry/data-pipeline:latest

          myregistry/data-pipeline:${{ github.sha }}
